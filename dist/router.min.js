/**
* @name router.js
* @version 0.1.1
* @copyright 2021
* @author Eissa Saber
* @license MIT
*/
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.OlumRouter=t()}("undefined"!=typeof self?self:this,function(){"use strict";var m="undefined"!=typeof self?self:this,g="OlumRouter [warn]:",o=!1;function v(e){return null!=e}function t(e){return null!==e&&"object"==typeof e}function y(e){return t(e)&&Array.isArray(e)&&e.length}function w(e,t){t="err"==(t=!v(t)?"log":t)?"error":t,o&&(Array.isArray(e)?console[t].apply(console,e):console[t](e))}return String.prototype.cap=function(){return this.toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")},function e(t){if(!(this instanceof e))throw new Error("can't invoke 'OlumRouter' without 'new' keyword");if(!t)throw new Error(g+" Missing config object @OlumRouter");var a,u,s=this,o=m.history.pushState,c=[],l="/",f=!1,r=null,n=null;function h(e){var t=new RegExp("^[#/]{1,}|/$","g");return e=String(e).toLowerCase().trim().replace(t,"")}function i(e){var t=h(l);return e=h(e),"/"!=(e="/"!==l?"/"+t+"/"+e:"/"+e)?e.replace(/\/$/g,""):e}function p(e){if(!e||"function"!=typeof e)throw new Error(g+" Missing View argument @OlumRouter");var t=(new e).data(),e=s.buildTree(t),e=-1!==["localhost","127.0.0.1"].indexOf(m.location.hostname)?s.labelView(t,e):{entry:t,compsArr:e},r=s.merge(e);s.buildStyles(r.style),s.rootElm.innerHTML=r.template,setTimeout(()=>{!function(e){var t=[].slice.call(document.querySelectorAll("[to]"));if(y(t))for(var o=0;o<t.length;o++)i(t[o].getAttribute("to"))===e?t[o].className+=" active":t[o].className=t[o].className.replace(/active/g,"")}(s.getRoute()),function(){var e=[].slice.call(document.querySelectorAll("[to]"));if(y(e))for(var t=0;t<e.length;t++)"A"===e[t].nodeName&&e[t].setAttribute("href","javascript:void(0)"),e[t].addEventListener("click",function(e){e=e.target.getAttribute("to"),i(e)!==s.getRoute()&&s.navigate(e)})}();var o=Object.keys(r.script);!function e(t){r.script[o[t]](),t===o.length-1&&v(n)&&(dispatchEvent(n),w("viewLoaded")),t+1<=o.length-1&&e(t+1)}(0)},0)}function d(){if(t&&t.routes&&y(t.routes)){for(let e=0;e<t.routes.length;e++)!function(e,t){c.push({path:i(e),cb:function(){p(t)}})}(t.routes[e].path,t.routes[e].comp);return 1}}if(a=t&&"history"===t.mode&&o?"history":"hash",l=t&&t.root?t.root:"/",u=t&&t.err?i(t.err):null,this.isReady=!1,this.name=function(){return"OlumRouter"},this.freeze=function(){f=!0},this.unfreeze=function(){f=!1},this.getRoute=function(){var e="";return"history"==a?e=h(decodeURIComponent(location.pathname)):"hash"==a&&(e=h(decodeURIComponent(location.hash))),"/"+e},this.navigate=function(e){var t;s.unfreeze(),e=i(e),"history"==a?(m.history.pushState({},"",e),w("Pushed to history"),dispatchEvent(r)):"hash"==a&&("/"===l?location.href=location.href.replace(/\#.*/g,"")+"#"+e:(t=(t=h(l)).replace(/\//g,"\\/"),t=new RegExp("\\/"+t,"g"),t="/"+(t=e.replace(t,"")).replace(/^\//g,""),location.href=location.href.replace(/\#.*/g,"")+"#"+t))},this.listen=function(){w(s.__proto__),m.addEventListener("popstate",function(){w(["Dispatched Popstate",c]);for(var e,t=s.getRoute(),o="/"+h(l),t="hash"==a&&"/"!==l?(t=o+t).replace(/\/$/,""):t,r=0;r<c.length;r++){if(c[r].path===t){e=c[r];break}if(""===t||"/"===t||t.includes("index.html")){e=c[r].path===o;break}}if(v(e))f||e.cb();else if(v(u)){for(var n,i=0;i<c.length;i++)if(c[i].path===u){n=c[i];break}v(n)?n.cb():console.error(g+" Unmached path @OlumRouter")}else s.rootElm.innerHTML="Not Found!";w({current:t,route:e})}),dispatchEvent(r)},!d())throw new Error(g+" No routes found!");r=new PopStateEvent("popstate"),n=new CustomEvent("viewLoaded",{detail:{},bubbles:!0,cancelable:!0,composed:!1}),this.isReady=!0}});