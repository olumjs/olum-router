/**
* @name olum-router
* @version 0.2.3
* @copyright 2021
* @author Eissa Saber
* @license MIT
*/
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.OlumRouter=t()}("undefined"!=typeof self?self:this,function(){"use strict";var l="undefined"!=typeof self?self:this,v="OlumRouter [warn]:",r=!1;function y(e){return null!=e}function t(e){return null!==e&&"object"==typeof e}function u(e){return t(e)&&Array.isArray(e)&&e.length}function w(e,t){t="err"==(t=!y(t)?"log":t)?"error":t,r&&(Array.isArray(e)?console[t].apply(console,e):console[t](e))}return String.prototype.cap=function(){return this.toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")},function e(t){if(!(this instanceof e))throw new Error("can't invoke 'OlumRouter' without 'new' keyword");if(!t)throw new Error(v+" Missing config object @OlumRouter");var c,h,f=this,r=l.history.pushState,p=[],d="/",m=!1,o=null,n=null;function g(e){var t=new RegExp("^[#/]{1,}|/$","g");return e=String(e).toLowerCase().trim().replace(t,"")}function i(e){var t=g(d);return e=g(e),"/"!=(e="/"!==d?"/"+t+"/"+e:"/"+e)?e.replace(/\/$/g,""):e}function a(e){if(!e||"function"!=typeof e)throw new Error(v+" Missing View argument @OlumRouter");var t=(new e).olumCompData(),e=f.buildTree(t),e=-1!==["localhost","127.0.0.1"].indexOf(l.location.hostname)?f.labelView(t,e):{entry:t,compsArr:e},o=f.merge(e);f.buildStyles(o.style),f.rootElm.innerHTML=o.template,setTimeout(()=>{!function(e){var t=[].slice.call(document.querySelectorAll("[to]"));if(u(t))for(var r=0;r<t.length;r++)i(t[r].getAttribute("to"))===e?t[r].className+=" active":t[r].className=t[r].className.replace(/active/g,"")}(f.getRoute()),function(){var e=[].slice.call(document.querySelectorAll("[to]"));if(u(e))for(var t=0;t<e.length;t++)"A"===e[t].nodeName&&e[t].setAttribute("href","javascript:void(0)"),e[t].addEventListener("click",function(e){e=e.target.getAttribute("to"),i(e)!==f.getRoute()&&f.navigate(e)})}();var r=Object.keys(o.script);!function e(t){o.script[r[t]](),t===r.length-1&&y(n)&&(dispatchEvent(n),w("viewLoaded")),t+1<=r.length-1&&e(t+1)}(0)},0)}function s(){if(t&&t.routes&&u(t.routes)){for(let e=0;e<t.routes.length;e++)!function(e,t){p.push({path:i(e),cb:function(){a(t)}})}(t.routes[e].path,t.routes[e].comp);return 1}}if(c=t&&"history"===t.mode&&r?"history":"hash",d=t&&t.root?t.root:"/",h=t&&t.err?i(t.err):null,this.isReady=!1,this.params={},this.name=function(){return"OlumRouter"},this.freeze=function(){m=!0},this.unfreeze=function(){m=!1},this.getRoute=function(){var e="";return"history"==c?e=g(decodeURIComponent(location.pathname)):"hash"==c&&(e=g(decodeURIComponent(location.hash))),"/"+e},this.navigate=function(e){var t;f.unfreeze(),e=i(e),"history"==c?(l.history.pushState({},"",e),w("Pushed to history"),dispatchEvent(o)):"hash"==c&&("/"===d?location.href=location.href.replace(/\#.*/g,"")+"#"+e:(t=(t=g(d)).replace(/\//g,"\\/"),t=new RegExp("\\/"+t,"g"),t="/"+(t=e.replace(t,"")).replace(/^\//g,""),location.href=location.href.replace(/\#.*/g,"")+"#"+t))},this.listen=function(){w(f.__proto__),l.addEventListener("popstate",function(){w(["Dispatched Popstate",p]);var e=f.getRoute(),t="/"+g(d);e="hash"==c&&"/"!==d?(e=t+e).replace(/\/$/,""):e;for(var r,o=0;o<p.length;o++){var n,i=p[o];-1!==i.path.indexOf(":")&&(w(["has param -> ",i]),i=(n=i.path.split(":"))[n.length-1],f.params[i]=null,n.pop(),n=n.join(""),w({paramKey:i}),w({cleanRoute:n}),-1!==e.indexOf(n)&&(w(["this.listen current1, -> ",e]),n=e.replace(n,""),f.params[i]=n,n=new RegExp("(\\/"+n+")"),w(["this.listen current2, -> ",e=e.replace(n,"/:"+i)])))}w(["$this.params -> ",f.params]);for(var a=0;a<p.length;a++){var s=p[a];if(e===s.path){r=s;break}if((""===e||"/"===e||-1!==e.indexOf("index.html"))&&s.path===t){r=s;break}}if(y(r))m||r.cb();else if(y(h)){for(var l,u=0;u<p.length;u++)if(p[u].path===h){l=p[u];break}y(l)?l.cb():console.error(v+" Unmached path @OlumRouter")}else f.rootElm.innerHTML="Not Found!";w({current:e,route:r})}),dispatchEvent(o)},!s())throw new Error(v+" No routes found!");o=new PopStateEvent("popstate"),n=new CustomEvent("viewLoaded",{detail:{},bubbles:!0,cancelable:!0,composed:!1}),this.isReady=!0}});