/**
* @name olum-router
* @version 0.1.3
* @copyright 2021
* @author Eissa Saber
* @license MIT
*/
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.OlumRouter=t()}("undefined"!=typeof self?self:this,function(){"use strict";var m="undefined"!=typeof self?self:this,g="OlumRouter [warn]:",o=!1;function v(e){return null!=e}function t(e){return null!==e&&"object"==typeof e}function y(e){return t(e)&&Array.isArray(e)&&e.length}function w(e,t){t="err"==(t=!v(t)?"log":t)?"error":t,o&&(Array.isArray(e)?console[t].apply(console,e):console[t](e))}return String.prototype.cap=function(){return this.toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")},function e(t){if(!(this instanceof e))throw new Error("can't invoke 'OlumRouter' without 'new' keyword");if(!t)throw new Error(g+" Missing config object @OlumRouter");var u,s,c=this,o=m.history.pushState,l=[],f="/",h=!1,r=null,n=null;function p(e){var t=new RegExp("^[#/]{1,}|/$","g");return e=String(e).toLowerCase().trim().replace(t,"")}function i(e){var t=p(f);return e=p(e),"/"!=(e="/"!==f?"/"+t+"/"+e:"/"+e)?e.replace(/\/$/g,""):e}function a(e){if(!e||"function"!=typeof e)throw new Error(g+" Missing View argument @OlumRouter");var t=(new e).olumCompData(),e=c.buildTree(t),e=-1!==["localhost","127.0.0.1"].indexOf(m.location.hostname)?c.labelView(t,e):{entry:t,compsArr:e},r=c.merge(e);c.buildStyles(r.style),c.rootElm.innerHTML=r.template,setTimeout(()=>{!function(e){var t=[].slice.call(document.querySelectorAll("[to]"));if(y(t))for(var o=0;o<t.length;o++)i(t[o].getAttribute("to"))===e?t[o].className+=" active":t[o].className=t[o].className.replace(/active/g,"")}(c.getRoute()),function(){var e=[].slice.call(document.querySelectorAll("[to]"));if(y(e))for(var t=0;t<e.length;t++)"A"===e[t].nodeName&&e[t].setAttribute("href","javascript:void(0)"),e[t].addEventListener("click",function(e){e=e.target.getAttribute("to"),i(e)!==c.getRoute()&&c.navigate(e)})}();var o=Object.keys(r.script);!function e(t){r.script[o[t]](),t===o.length-1&&v(n)&&(dispatchEvent(n),w("viewLoaded")),t+1<=o.length-1&&e(t+1)}(0)},0)}function d(){if(t&&t.routes&&y(t.routes)){for(let e=0;e<t.routes.length;e++)!function(e,t){l.push({path:i(e),cb:function(){a(t)}})}(t.routes[e].path,t.routes[e].comp);return 1}}if(u=t&&"history"===t.mode&&o?"history":"hash",f=t&&t.root?t.root:"/",s=t&&t.err?i(t.err):null,this.isReady=!1,this.name=function(){return"OlumRouter"},this.freeze=function(){h=!0},this.unfreeze=function(){h=!1},this.getRoute=function(){var e="";return"history"==u?e=p(decodeURIComponent(location.pathname)):"hash"==u&&(e=p(decodeURIComponent(location.hash))),"/"+e},this.navigate=function(e){var t;c.unfreeze(),e=i(e),"history"==u?(m.history.pushState({},"",e),w("Pushed to history"),dispatchEvent(r)):"hash"==u&&("/"===f?location.href=location.href.replace(/\#.*/g,"")+"#"+e:(t=(t=p(f)).replace(/\//g,"\\/"),t=new RegExp("\\/"+t,"g"),t="/"+(t=e.replace(t,"")).replace(/^\//g,""),location.href=location.href.replace(/\#.*/g,"")+"#"+t))},this.listen=function(){w(c.__proto__),m.addEventListener("popstate",function(){w(["Dispatched Popstate",l]);for(var e,t=c.getRoute(),o="/"+p(f),t="hash"==u&&"/"!==f?(t=o+t).replace(/\/$/,""):t,r=0;r<l.length;r++){var n=l[r];if(t===n.path){e=n;break}if((""===t||"/"===t||-1!==t.indexOf("index.html"))&&n.path===o){e=n;break}}if(v(e))h||e.cb();else if(v(s)){for(var i,a=0;a<l.length;a++)if(l[a].path===s){i=l[a];break}v(i)?i.cb():console.error(g+" Unmached path @OlumRouter")}else c.rootElm.innerHTML="Not Found!";w({current:t,route:e})}),dispatchEvent(r)},!d())throw new Error(g+" No routes found!");r=new PopStateEvent("popstate"),n=new CustomEvent("viewLoaded",{detail:{},bubbles:!0,cancelable:!0,composed:!1}),this.isReady=!0}});